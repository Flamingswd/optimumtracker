<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tekton Board Invitations</title>
    <style>
        :root {
            --brand-primary: #FF6B35;
            --brand-dark: #E65A27;
            --brand-secondary: #203647;
            --brand-light: #F7F9FC;
            --brand-muted: #5F7488;
            --card-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            --border-radius: 16px;
            --transition: 0.3s ease;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--brand-light);
            color: var(--brand-secondary);
            min-height: 100vh;
        }

        header {
            background: white;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .top-bar {
            max-width: 1220px;
            margin: 0 auto;
            padding: 18px 28px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .brand-logo {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--brand-primary), #FFD166);
            color: white;
            display: grid;
            place-items: center;
            font-weight: 700;
            font-size: 18px;
        }

        .brand-name {
            font-weight: 700;
            font-size: 22px;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            color: var(--brand-secondary);
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 24px;
            margin: 0;
            padding: 0;
        }

        nav a {
            text-decoration: none;
            color: var(--brand-muted);
            font-weight: 600;
            font-size: 15px;
            padding: 10px 0;
            position: relative;
            transition: color var(--transition);
        }

        nav a.active,
        nav a:hover {
            color: var(--brand-primary);
        }

        nav a.active::after,
        nav a:hover::after {
            content: "";
            position: absolute;
            bottom: -8px;
            left: 0;
            right: 0;
            height: 3px;
            border-radius: 999px;
            background: var(--brand-primary);
        }

        main {
            max-width: 1220px;
            margin: 32px auto 80px;
            padding: 0 28px;
            display: grid;
            grid-template-columns: minmax(0, 3fr) minmax(0, 4fr);
            gap: 24px;
        }

        .panel {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }

        .panel-header {
            padding: 24px 28px 16px;
            border-bottom: 1px solid rgba(32, 54, 71, 0.08);
        }

        .panel-header h2 {
            margin: 0;
            font-size: 24px;
            color: var(--brand-secondary);
        }

        .panel-subtitle {
            margin-top: 6px;
            color: var(--brand-muted);
            font-size: 14px;
        }

        .stats {
            display: flex;
            gap: 12px;
            margin-top: 18px;
        }

        .stat-pill {
            padding: 10px 16px;
            background: rgba(32, 54, 71, 0.05);
            border-radius: 999px;
            font-size: 13px;
            font-weight: 600;
            color: var(--brand-muted);
        }

        .filters {
            display: flex;
            gap: 12px;
            padding: 18px 24px;
            border-bottom: 1px solid rgba(32, 54, 71, 0.08);
        }

        .filter-button {
            border: none;
            background: rgba(32, 54, 71, 0.06);
            color: var(--brand-muted);
            padding: 10px 18px;
            border-radius: 999px;
            font-weight: 600;
            cursor: pointer;
            transition: background var(--transition), color var(--transition), transform var(--transition);
        }

        .filter-button:hover {
            transform: translateY(-1px);
        }

        .filter-button.active {
            background: var(--brand-primary);
            color: white;
            box-shadow: 0 12px 24px rgba(255, 107, 53, 0.25);
        }

        .filter-count {
            background: white;
            border-radius: 999px;
            padding: 4px 10px;
            margin-left: 8px;
            font-size: 12px;
        }

        .invitation-list {
            padding: 8px 0 16px;
            max-height: calc(100vh - 240px);
            overflow-y: auto;
        }

        .invitation-card {
            margin: 12px 16px;
            padding: 20px 22px;
            border: 1px solid rgba(32, 54, 71, 0.08);
            border-radius: 18px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            cursor: pointer;
            transition: border-color var(--transition), box-shadow var(--transition), transform var(--transition);
        }

        .invitation-card:hover {
            border-color: var(--brand-primary);
            box-shadow: 0 10px 24px rgba(255, 107, 53, 0.12);
            transform: translateY(-2px);
        }

        .invitation-card.active {
            border-color: var(--brand-primary);
            box-shadow: 0 12px 28px rgba(255, 107, 53, 0.18);
        }

        .invitation-top {
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }

        .board-name {
            font-size: 19px;
            font-weight: 700;
            color: var(--brand-secondary);
        }

        .status-pill {
            align-self: flex-start;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .status-pill.pending { background: rgba(255, 176, 0, 0.15); color: #A36200; }
        .status-pill.accepted { background: rgba(39, 174, 96, 0.15); color: #1B8C55; }
        .status-pill.declined { background: rgba(231, 76, 60, 0.18); color: #AF3927; }
        .status-pill.error { background: rgba(231, 76, 60, 0.12); color: #AF3927; }

        .invitation-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            color: var(--brand-muted);
            font-size: 13px;
        }

        .meta-item {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 12px;
            background: rgba(32, 54, 71, 0.05);
        }

        .role-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            color: var(--brand-secondary);
        }

        .message-preview {
            font-size: 15px;
            color: var(--brand-secondary);
            line-height: 1.5;
        }

        .empty-state {
            padding: 80px 24px;
            text-align: center;
            color: var(--brand-muted);
        }

        .empty-state strong {
            display: block;
            margin-top: 12px;
            color: var(--brand-secondary);
            font-size: 18px;
        }

        .detail-panel {
            padding-bottom: 32px;
        }

        .detail-header {
            padding: 28px 32px 20px;
            border-bottom: 1px solid rgba(32, 54, 71, 0.08);
        }

        .detail-title {
            font-size: 28px;
            margin: 0 0 10px;
        }

        .detail-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 14px;
        }

        .detail-meta-item {
            background: rgba(32, 54, 71, 0.04);
            padding: 14px 18px;
            border-radius: 14px;
            font-size: 14px;
            color: var(--brand-muted);
        }

        .detail-meta-item strong {
            display: block;
            color: var(--brand-secondary);
            margin-bottom: 4px;
        }

        .detail-section {
            padding: 28px 32px 0;
        }

        .detail-section h3 {
            margin: 0 0 16px;
            font-size: 18px;
            color: var(--brand-secondary);
        }

        .detail-body {
            background: rgba(32, 54, 71, 0.04);
            padding: 20px 22px;
            border-radius: 14px;
            color: var(--brand-secondary);
            line-height: 1.6;
        }

        .detail-grid {
            display: grid;
            gap: 18px;
        }

        .participant-list {
            display: grid;
            gap: 12px;
        }

        .participant {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: white;
            border-radius: 12px;
            box-shadow: inset 0 0 0 1px rgba(32, 54, 71, 0.08);
        }

        .participant-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .participant-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.22), rgba(32, 54, 71, 0.25));
            color: var(--brand-secondary);
            display: grid;
            place-items: center;
            font-weight: 700;
        }

        .participant-role {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--brand-muted);
            letter-spacing: 0.04em;
        }

        .timeline {
            display: grid;
            gap: 16px;
        }

        .timeline-item {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .timeline-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--brand-primary);
            margin-top: 6px;
        }

        .timeline-content {
            background: white;
            padding: 14px 18px;
            border-radius: 12px;
            box-shadow: inset 0 0 0 1px rgba(32, 54, 71, 0.08);
            flex: 1;
        }

        .timeline-content strong {
            display: block;
            color: var(--brand-secondary);
            margin-bottom: 4px;
        }

        .actions {
            display: flex;
            gap: 12px;
            padding: 28px 32px 0;
        }

        .button {
            border: none;
            border-radius: 14px;
            padding: 16px 22px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            transition: transform var(--transition), box-shadow var(--transition);
            flex: 1;
        }

        .button.primary {
            background: var(--brand-primary);
            color: white;
            box-shadow: 0 16px 32px rgba(255, 107, 53, 0.25);
        }

        .button.primary:hover {
            transform: translateY(-2px);
        }

        .button.secondary {
            background: rgba(32, 54, 71, 0.06);
            color: var(--brand-secondary);
        }

        .button.secondary:hover {
            transform: translateY(-2px);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .toast {
            position: fixed;
            right: 28px;
            bottom: 28px;
            min-width: 240px;
            background: var(--brand-secondary);
            color: white;
            padding: 16px 22px;
            border-radius: 16px;
            box-shadow: 0 18px 30px rgba(32, 54, 71, 0.25);
            opacity: 0;
            transform: translateY(30px);
            pointer-events: none;
            transition: opacity var(--transition), transform var(--transition);
            z-index: 20;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .security-alert {
            padding: 16px 18px;
            background: rgba(231, 76, 60, 0.12);
            border: 1px solid rgba(231, 76, 60, 0.35);
            color: #AF3927;
            border-radius: 12px;
            font-size: 14px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
            margin-top: 20px;
        }

        .security-alert strong {
            display: block;
            margin-bottom: 4px;
        }

        @media (max-width: 1024px) {
            main {
                grid-template-columns: 1fr;
            }

            .invitation-list {
                max-height: none;
            }
        }

        @media (max-width: 680px) {
            .top-bar {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }

            nav ul {
                flex-wrap: wrap;
                gap: 16px;
            }

            .filters {
                flex-wrap: wrap;
            }

            .filter-button {
                flex: 1 0 45%;
                text-align: center;
            }

            .actions {
                flex-direction: column;
            }

            .button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<header>
    <div class="top-bar">
        <div class="brand">
            <div class="brand-logo">Tk</div>
            <div>
                <div class="brand-name">Tekton</div>
                <div style="font-size: 12px; color: var(--brand-muted);">Integrated project collaboration hub</div>
            </div>
        </div>
        <nav>
            <ul>
                <li><a href="#" aria-current="page">Dashboard</a></li>
                <li><a href="#">Tekton Boards</a></li>
                <li><a href="#" class="active">Invitations</a></li>
                <li><a href="#">All Tekton Boards</a></li>
            </ul>
        </nav>
    </div>
</header>

<main>
    <section class="panel">
        <div class="panel-header">
            <h2>Board Invitations</h2>
            <p class="panel-subtitle">Manage every Tekton board invitation from buyers, professionals, suppliers and admins.</p>
            <div class="stats" id="summaryStats"></div>
        </div>
        <div class="filters" id="filters"></div>
        <div class="invitation-list" id="invitationList"></div>
    </section>

    <aside class="panel detail-panel" id="detailPanel">
        <div class="detail-header">
            <p style="margin: 0; font-size: 14px; letter-spacing: 0.04em; text-transform: uppercase; color: var(--brand-muted);">Invitation Details</p>
            <h1 class="detail-title" id="detailTitle">Select an invitation</h1>
            <div class="status-pill pending" id="detailStatus" style="display: none; margin-top: 12px;">Pending</div>
            <div class="detail-meta" id="detailMeta" style="display: none;"></div>
        </div>

        <div id="detailContent" style="display: none;">
            <section class="detail-section">
                <h3>Message</h3>
                <div class="detail-body" id="detailMessage"></div>
            </section>

            <section class="detail-section">
                <h3>Participants & Roles</h3>
                <div class="detail-grid participant-list" id="participantList"></div>
            </section>

            <section class="detail-section">
                <h3>Timeline</h3>
                <div class="detail-body">
                    <div class="timeline" id="detailTimeline"></div>
                </div>
            </section>

            <section class="detail-section" id="detailSecuritySection" style="display: none;">
                <h3>Security Check</h3>
                <div class="security-alert">
                    <div style="font-size: 20px;">⚠️</div>
                    <div>
                        <strong id="securityTitle"></strong>
                        <div id="securityDescription"></div>
                    </div>
                </div>
            </section>

            <div class="actions" id="actionButtons" style="display: none;">
                <button class="button secondary" id="declineButton">Decline</button>
                <button class="button primary" id="acceptButton">Accept Invitation</button>
            </div>
        </div>
    </aside>
</main>

<div class="toast" id="toast"></div>

<script>
    const state = {
        invitations: [
            {
                id: "INV-2033",
                boardName: "Residential Construction – 3000m²",
                boardType: "Residential Construction",
                invitedBy: "Victor Boluwatife Adeoye",
                invitedByRole: "Buyer",
                invitationDate: "2025-11-07",
                projectStart: "2026-01-15",
                dueDate: "2025-11-25",
                roleRequested: "Supplier",
                organisation: "Tgylk Materials",
                status: "pending",
                message: "I'd like to invite you to join Residential Construction – 3000m² for our Residential Construction project.",
                requirements: ["Share delivery schedules", "Upload compliance certificates", "Participate in procurement meetings"],
                participants: [
                    { name: "Victor Boluwatife Adeoye", role: "Buyer", email: "victor@tektonhq.com" },
                    { name: "Grace Ajayi", role: "Architect", email: "grace@urbanshape.studio" },
                    { name: "Ngozi Onuoha", role: "Engineer", email: "ngozi@structura.ng" }
                ],
                timeline: [
                    { title: "Invitation sent", description: "The invitation was sent by Victor", date: "Nov 7, 2025" },
                    { title: "Supplier access review", description: "Waiting for your response to unlock board resources", date: "Pending" }
                ],
                security: {
                    hasError: true,
                    title: "Row-level security blocked this invitation",
                    description: "Your Tekton account does not yet have visibility to the board_members table. Ask the buyer or Tekton support to share the board with your company or adjust permissions."
                }
            },
            {
                id: "INV-2040",
                boardName: "Commercial Complex Redevelopment",
                boardType: "Commercial",
                invitedBy: "Ademola Adebayo",
                invitedByRole: "Admin",
                invitationDate: "2025-10-18",
                projectStart: "2025-12-05",
                dueDate: "2025-11-02",
                roleRequested: "Engineer",
                organisation: "BuildTek Engineering",
                status: "accepted",
                acceptedOn: "2025-10-20",
                message: "Tekton admin Ademola added you as the lead structural engineer for the redevelopment board.",
                requirements: ["Upload structural models", "Confirm design review milestones"],
                participants: [
                    { name: "Ademola Adebayo", role: "Admin", email: "ademola@tekton.io" },
                    { name: "Tope Ogun", role: "Buyer", email: "tope@lagoscapital.dev" },
                    { name: "You", role: "Engineer", email: "you@buildtek.ng" }
                ],
                timeline: [
                    { title: "Invitation sent", description: "The invitation was issued by Tekton admin", date: "Oct 18, 2025" },
                    { title: "Accepted", description: "You joined the board", date: "Oct 20, 2025" },
                    { title: "Kick-off meeting", description: "Scheduled with buyer and architect", date: "Nov 3, 2025" }
                ],
                security: {
                    hasError: false,
                    title: "",
                    description: ""
                }
            },
            {
                id: "INV-1998",
                boardName: "Healthcare Facility Expansion",
                boardType: "Healthcare",
                invitedBy: "Chioma Okeke",
                invitedByRole: "Professional",
                invitationDate: "2025-09-01",
                projectStart: "2025-10-10",
                dueDate: "2025-09-07",
                roleRequested: "Buyer",
                organisation: "Tekton Partners",
                status: "declined",
                declinedOn: "2025-09-05",
                message: "We'd love you to co-own the Tekton board to manage procurement approvals for the expansion.",
                requirements: ["Approve major purchases", "Monitor supplier requests"],
                participants: [
                    { name: "Chioma Okeke", role: "Architect", email: "chioma@blueprint.africa" },
                    { name: "Samuel Udoh", role: "Engineer", email: "samuel@civicstructs.com" }
                ],
                timeline: [
                    { title: "Invitation sent", description: "Chioma invited you as co-buyer", date: "Sep 1, 2025" },
                    { title: "Declined", description: "You declined the board invitation", date: "Sep 5, 2025" }
                ],
                security: {
                    hasError: false,
                    title: "",
                    description: ""
                }
            }
        ],
        filter: "pending",
        selected: null
    };

    const filtersConfig = [
        { id: "pending", label: "Pending" },
        { id: "accepted", label: "Accepted" },
        { id: "declined", label: "Declined" },
        { id: "service", label: "Service Requests" }
    ];

    const filterOrder = { pending: 0, accepted: 1, declined: 2 };

    const statsElement = document.getElementById("summaryStats");
    const filtersElement = document.getElementById("filters");
    const listElement = document.getElementById("invitationList");
    const toast = document.getElementById("toast");

    const detailPanel = {
        container: document.getElementById("detailPanel"),
        title: document.getElementById("detailTitle"),
        status: document.getElementById("detailStatus"),
        meta: document.getElementById("detailMeta"),
        content: document.getElementById("detailContent"),
        message: document.getElementById("detailMessage"),
        participants: document.getElementById("participantList"),
        timeline: document.getElementById("detailTimeline"),
        securitySection: document.getElementById("detailSecuritySection"),
        securityTitle: document.getElementById("securityTitle"),
        securityDescription: document.getElementById("securityDescription"),
        actions: document.getElementById("actionButtons"),
        accept: document.getElementById("acceptButton"),
        decline: document.getElementById("declineButton")
    };

    function formatDate(dateString) {
        if (!dateString) return "";
        const date = new Date(dateString);
        return date.toLocaleDateString(undefined, { year: "numeric", month: "short", day: "numeric" });
    }

    function getStatusLabel(status) {
        switch (status) {
            case "pending":
                return "Pending";
            case "accepted":
                return "Accepted";
            case "declined":
                return "Declined";
            default:
                return status;
        }
    }

    function renderStats() {
        const total = state.invitations.length;
        const pending = state.invitations.filter(inv => inv.status === "pending").length;
        const accepted = state.invitations.filter(inv => inv.status === "accepted").length;
        const declined = state.invitations.filter(inv => inv.status === "declined").length;

        statsElement.innerHTML = `
            <div class="stat-pill">Total invitations: <strong>${total}</strong></div>
            <div class="stat-pill">Pending: <strong>${pending}</strong></div>
            <div class="stat-pill">Accepted: <strong>${accepted}</strong></div>
            <div class="stat-pill">Declined: <strong>${declined}</strong></div>
        `;
    }

    function getFilteredInvitations() {
        if (state.filter === "service") {
            return [];
        }
        return state.invitations
            .filter(invitation => invitation.status === state.filter)
            .sort((a, b) => {
                if (a.status !== b.status) {
                    return filterOrder[a.status] - filterOrder[b.status];
                }
                return new Date(b.invitationDate) - new Date(a.invitationDate);
            });
    }

    function syncSelection(filteredInvitations) {
        if (state.filter === "service" || !filteredInvitations.length) {
            state.selected = null;
            return;
        }

        const stillVisible = filteredInvitations.some(inv => state.selected && inv.id === state.selected.id);
        if (!state.selected || state.selected.status !== state.filter || !stillVisible) {
            state.selected = filteredInvitations[0];
        }
    }

    function renderFilters() {
        filtersElement.innerHTML = "";
        filtersConfig.forEach(filter => {
            const button = document.createElement("button");
            button.className = `filter-button ${state.filter === filter.id ? "active" : ""}`;
            button.textContent = filter.label;
            const count = state.invitations.filter(inv => inv.status === filter.id).length;
            if (["pending", "accepted", "declined"].includes(filter.id)) {
                const badge = document.createElement("span");
                badge.className = "filter-count";
                badge.textContent = count;
                button.appendChild(badge);
            }
            button.addEventListener("click", () => {
                state.filter = filter.id;
                render();
            });
            filtersElement.appendChild(button);
        });
    }

    function renderInvitations(filteredInvitations) {
        listElement.innerHTML = "";

        if (state.filter === "service") {
            listElement.innerHTML = `
                <div class="empty-state">
                    <strong>No service requests yet</strong>
                    Service requests from Tekton support or marketplace vendors will be shown here.
                </div>
            `;
            return;
        }

        if (!filteredInvitations.length) {
            listElement.innerHTML = `
                <div class="empty-state">
                    <strong>No ${state.filter} invitations</strong>
                    Invitations assigned to your Tekton profile will be displayed here as soon as they arrive.
                </div>
            `;
            return;
        }

        filteredInvitations.forEach(invitation => {
            const card = document.createElement("article");
            card.className = `invitation-card ${state.selected && state.selected.id === invitation.id ? "active" : ""}`;
            card.setAttribute("role", "button");
            card.setAttribute("tabindex", "0");
            card.innerHTML = `
                <div class="invitation-top">
                    <div>
                        <div class="board-name">${invitation.boardName}</div>
                        <div class="role-badge">Role: ${invitation.roleRequested}</div>
                    </div>
                    <div class="status-pill ${invitation.status} ${invitation.security.hasError ? "error" : ""}">
                        ${invitation.security.hasError ? "Error" : getStatusLabel(invitation.status)}
                    </div>
                </div>
                <div class="invitation-meta">
                    <span class="meta-item">Invited by ${invitation.invitedBy} (${invitation.invitedByRole})</span>
                    <span class="meta-item">Invited on ${formatDate(invitation.invitationDate)}</span>
                    <span class="meta-item">Board type: ${invitation.boardType}</span>
                    <span class="meta-item">Organisation: ${invitation.organisation}</span>
                </div>
                <div class="message-preview">${invitation.message}</div>
            `;

            card.addEventListener("click", () => {
                state.selected = invitation;
                render();
            });
            card.addEventListener("keypress", (event) => {
                if (event.key === "Enter" || event.key === " ") {
                    event.preventDefault();
                    state.selected = invitation;
                    render();
                }
            });

            listElement.appendChild(card);
        });
    }

    function renderDetail() {
        const invitation = state.selected;
        if (!invitation) {
            detailPanel.title.textContent = "Select an invitation";
            detailPanel.status.style.display = "none";
            detailPanel.meta.style.display = "none";
            detailPanel.content.style.display = "none";
            return;
        }

        detailPanel.content.style.display = "block";
        detailPanel.title.textContent = invitation.boardName;
        detailPanel.status.textContent = invitation.security.hasError ? "Access blocked" : getStatusLabel(invitation.status);
        detailPanel.status.className = `status-pill ${invitation.security.hasError ? "error" : invitation.status}`;
        detailPanel.status.style.display = "inline-flex";

        const metaItems = [
            { label: "Invited by", value: `${invitation.invitedBy} (${invitation.invitedByRole})` },
            { label: "Invitation date", value: formatDate(invitation.invitationDate) },
            { label: "Response due", value: formatDate(invitation.dueDate) || "Not set" },
            { label: "Project start", value: formatDate(invitation.projectStart) || "TBC" },
            { label: "Requested role", value: invitation.roleRequested },
            { label: "Organisation", value: invitation.organisation }
        ];

        detailPanel.meta.innerHTML = metaItems
            .map(item => `
                <div class="detail-meta-item">
                    <strong>${item.label}</strong>
                    ${item.value || "—"}
                </div>
            `)
            .join("");
        detailPanel.meta.style.display = "grid";

        const requirements = invitation.requirements && invitation.requirements.length
            ? `<ul style="margin: 12px 0 0 20px; color: var(--brand-muted);">${invitation.requirements.map(req => `<li>${req}</li>`).join("")}</ul>`
            : "";
        detailPanel.message.innerHTML = `
            <strong style="display:block; margin-bottom: 8px;">${invitation.invitedBy.split(" ")[0]} wrote:</strong>
            ${invitation.message}
            ${requirements}
        `;

        detailPanel.participants.innerHTML = invitation.participants.map(participant => {
            const initials = participant.name.split(" ").map(part => part[0]).join("").slice(0, 2).toUpperCase();
            return `
                <div class="participant">
                    <div class="participant-info">
                        <div class="participant-avatar">${initials}</div>
                        <div>
                            <div style="font-weight: 600;">${participant.name}</div>
                            <div class="participant-role">${participant.role}</div>
                            <div style="font-size: 12px; color: var(--brand-muted);">${participant.email}</div>
                        </div>
                    </div>
                    <div style="font-size: 12px; color: var(--brand-muted);">Collaborator</div>
                </div>
            `;
        }).join("");

        detailPanel.timeline.innerHTML = invitation.timeline.map(item => `
            <div class="timeline-item">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                    <strong>${item.title}</strong>
                    <div style="color: var(--brand-muted);">${item.description}</div>
                    <div style="margin-top: 6px; font-size: 12px; color: var(--brand-muted); text-transform: uppercase; letter-spacing: 0.04em;">${item.date}</div>
                </div>
            </div>
        `).join("");

        if (invitation.security.hasError) {
            detailPanel.securityTitle.textContent = invitation.security.title;
            detailPanel.securityDescription.textContent = invitation.security.description;
            detailPanel.securitySection.style.display = "block";
        } else {
            detailPanel.securitySection.style.display = "none";
        }

        if (invitation.status === "pending") {
            detailPanel.actions.style.display = "flex";
            detailPanel.accept.disabled = false;
            detailPanel.decline.disabled = false;
            detailPanel.accept.textContent = invitation.security.hasError ? "Retry after fixing access" : "Accept Invitation";
        } else {
            detailPanel.actions.style.display = "none";
        }
    }

    function showToast(message) {
        toast.textContent = message;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 3200);
    }

    function handleAccept() {
        const invitation = state.selected;
        if (!invitation) return;

        if (invitation.security.hasError) {
            showToast("Access blocked by row-level security. Ask the inviter to grant visibility.");
            return;
        }

        invitation.status = "accepted";
        invitation.acceptedOn = new Date().toISOString();
        invitation.timeline.push({
            title: "Accepted",
            description: "You accepted the Tekton board invitation",
            date: formatDate(invitation.acceptedOn)
        });
        showToast("Invitation accepted. You now have access to the Tekton board.");
        state.filter = "accepted";
        render();
    }

    function handleDecline() {
        const invitation = state.selected;
        if (!invitation) return;

        invitation.status = "declined";
        invitation.declinedOn = new Date().toISOString();
        invitation.timeline.push({
            title: "Declined",
            description: "You declined the Tekton board invitation",
            date: formatDate(invitation.declinedOn)
        });
        showToast("Invitation declined. The inviter will be notified.");
        state.filter = "declined";
        render();
    }

    detailPanel.accept.addEventListener("click", handleAccept);
    detailPanel.decline.addEventListener("click", handleDecline);

    function render() {
        const filteredInvitations = getFilteredInvitations();
        syncSelection(filteredInvitations);
        renderStats();
        renderFilters();
        renderInvitations(filteredInvitations);
        renderDetail();
    }

    render();
</script>
</body>
</html>
